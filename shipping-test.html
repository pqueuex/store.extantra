<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Calculator Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
        }
        .test-input {
            margin: 10px 0;
        }
        input, button {
            padding: 8px;
            margin: 5px;
        }
        .results {
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            margin: 10px 0;
        }
        .zone-result {
            font-weight: bold;
            color: #007bff;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Shipping Calculator Test Interface</h1>
    
    <div class="test-section">
        <h2>Zone Detection Test</h2>
        <div class="test-input">
            <label>ZIP Code: </label>
            <input type="text" id="test-zip" placeholder="Enter ZIP code" maxlength="10">
            <button onclick="testZoneDetection()">Test Zone Detection</button>
        </div>
        <div class="results" id="zone-results">
            Results will appear here...
        </div>
    </div>

    <div class="test-section">
        <h2>Shipping Rate Calculation Test</h2>
        <div class="test-input">
            <label>ZIP Code: </label>
            <input type="text" id="rate-zip" placeholder="Enter ZIP code" maxlength="10">
            <label>Order Total: $</label>
            <input type="number" id="order-total" placeholder="0.00" step="0.01" min="0">
            <label>Item Count: </label>
            <input type="number" id="item-count" placeholder="0" min="0" max="10">
            <button onclick="testShippingRates()">Calculate Shipping</button>
        </div>
        <div class="results" id="rate-results">
            Results will appear here...
        </div>
    </div>

    <div class="test-section">
        <h2>Predefined Test Cases</h2>
        <button onclick="runAllTests()">Run All Tests</button>
        <div class="results" id="test-results">
            Click "Run All Tests" to see comprehensive test results...
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';

        // Test zone detection for a specific ZIP code
        async function testZoneDetection() {
            const zipCode = document.getElementById('test-zip').value.trim();
            const resultsDiv = document.getElementById('zone-results');
            
            if (!zipCode) {
                resultsDiv.innerHTML = '<div class="error">Please enter a ZIP code</div>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/calculate-shipping`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        zipCode: zipCode,
                        items: [],
                        orderTotal: 0
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                let html = `
                    <div class="zone-result">ZIP Code: ${zipCode}</div>
                    <div>Zone: ${data.zone || 'default'}</div>
                    <div>Free Shipping: ${data.freeShipping ? 'Yes' : 'No'}</div>
                    <h4>Shipping Options:</h4>
                `;

                data.options.forEach(option => {
                    html += `
                        <div>
                            <strong>${option.name}</strong>: $${option.cost.toFixed(2)} 
                            (${option.transit})
                        </div>
                    `;
                });

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Test shipping rate calculation with order details
        async function testShippingRates() {
            const zipCode = document.getElementById('rate-zip').value.trim();
            const orderTotal = parseFloat(document.getElementById('order-total').value) || 0;
            const itemCount = parseInt(document.getElementById('item-count').value) || 0;
            const resultsDiv = document.getElementById('rate-results');

            if (!zipCode) {
                resultsDiv.innerHTML = '<div class="error">Please enter a ZIP code</div>';
                return;
            }

            // Create mock items for testing
            const items = Array(itemCount).fill().map((_, i) => ({
                id: i + 1,
                name: `Test Item ${i + 1}`,
                price: orderTotal / itemCount || 30
            }));

            try {
                const response = await fetch(`${API_BASE}/calculate-shipping`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        zipCode: zipCode,
                        items: items,
                        orderTotal: orderTotal
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                let html = `
                    <div><strong>Test Parameters:</strong></div>
                    <div>ZIP Code: ${zipCode}</div>
                    <div>Order Total: $${orderTotal.toFixed(2)}</div>
                    <div>Item Count: ${itemCount}</div>
                    <div>Zone: ${data.zone || 'default'}</div>
                    <div>Free Shipping Eligible: ${data.freeShipping ? 'Yes' : 'No'}</div>
                    <h4>Calculated Shipping Options:</h4>
                `;

                data.options.forEach(option => {
                    html += `
                        <div style="padding: 5px; border-left: 3px solid #007bff; margin: 5px 0;">
                            <strong>${option.name}</strong>: $${option.cost.toFixed(2)}<br>
                            <small>${option.transit} - ${option.description || 'No description'}</small>
                        </div>
                    `;
                });

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Run comprehensive test suite
        async function runAllTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<div>Running tests...</div>';

            const testCases = [
                { zip: '90210', zone: 'west_coast', name: 'West Coast (Beverly Hills)' },
                { zip: '10001', zone: 'east_coast', name: 'East Coast (NYC)' },
                { zip: '60601', zone: 'central', name: 'Central (Chicago)' },
                { zip: '80302', zone: 'mountain', name: 'Mountain (Boulder, CO)' },
                { zip: '96815', zone: 'alaska_hawaii', name: 'Hawaii (Honolulu)' },
                { zip: '99501', zone: 'alaska_hawaii', name: 'Alaska (Anchorage)' },
                { zip: '12345', zone: null, name: 'Invalid/Default Zone' }
            ];

            let results = '<h3>Comprehensive Test Results</h3>';
            let passCount = 0;
            let totalTests = 0;

            for (const testCase of testCases) {
                try {
                    // Test with low order total (should show regular shipping)
                    const lowOrderResponse = await fetch(`${API_BASE}/calculate-shipping`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            zipCode: testCase.zip,
                            items: [{ name: 'Test Item', price: 30 }],
                            orderTotal: 30
                        })
                    });

                    const lowOrderData = await lowOrderResponse.json();
                    totalTests++;

                    if (lowOrderData.freeShipping === false) {
                        results += `<div class="success">✅ ${testCase.name} (${testCase.zip}) - Low order test passed</div>`;
                        passCount++;
                    } else {
                        results += `<div class="error">❌ ${testCase.name} (${testCase.zip}) - Low order test failed</div>`;
                    }

                    // Test with high order total (should show free shipping)
                    const highOrderResponse = await fetch(`${API_BASE}/calculate-shipping`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            zipCode: testCase.zip,
                            items: [
                                { name: 'Test Item 1', price: 30 },
                                { name: 'Test Item 2', price: 30 },
                                { name: 'Test Item 3', price: 30 }
                            ],
                            orderTotal: 90
                        })
                    });

                    const highOrderData = await highOrderResponse.json();
                    totalTests++;

                    if (highOrderData.freeShipping === true) {
                        results += `<div class="success">✅ ${testCase.name} (${testCase.zip}) - Free shipping test passed</div>`;
                        passCount++;
                    } else {
                        results += `<div class="error">❌ ${testCase.name} (${testCase.zip}) - Free shipping test failed</div>`;
                    }

                    // Show shipping rates for reference
                    results += `<div style="margin-left: 20px; font-size: 12px; color: #666;">`;
                    results += `Zone: ${lowOrderData.zone || 'default'}, Options: `;
                    lowOrderData.options.forEach(opt => {
                        results += `${opt.name} $${opt.cost.toFixed(2)}, `;
                    });
                    results += `</div>`;

                } catch (error) {
                    results += `<div class="error">❌ ${testCase.name} (${testCase.zip}) - Error: ${error.message}</div>`;
                    totalTests += 2; // Both tests failed
                }
            }

            results += `<div style="margin-top: 20px; padding: 10px; border: 2px solid ${passCount === totalTests ? 'green' : 'orange'};">`;
            results += `<strong>Test Summary: ${passCount}/${totalTests} tests passed</strong>`;
            results += `</div>`;

            resultsDiv.innerHTML = results;
        }

        // Auto-run basic test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('test-zip').value = '90210';
                testZoneDetection();
            }, 1000);
        });
    </script>
</body>
</html>
